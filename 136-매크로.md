# ë§¤í¬ë¡œ
Rustì˜ ë§¤í¬ë¡œëŠ” ë‹¨ìˆœí•œ ì½”ë“œ ì¹˜í™˜ì„ ë„˜ì–´ì„œ ì»´íŒŒì¼ íƒ€ì„ì— ì½”ë“œ ìƒì„±ê³¼ ì œì–´ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ê°•ë ¥í•œ ë„êµ¬.


## ğŸ§  ë§¤í¬ë¡œë€?
- ì»´íŒŒì¼ íƒ€ì„ì— ì½”ë“œ ìƒì„±ì„ ìˆ˜í–‰í•˜ëŠ” ê¸°ëŠ¥
- ë°˜ë³µë˜ëŠ” íŒ¨í„´ì„ ì¤„ì´ê³ , ë‹¤ì–‘í•œ ì…ë ¥ì„ ì²˜ë¦¬í•˜ë©°, ëŸ°íƒ€ì„ ë¹„ìš© ì—†ì´ ì½”ë“œ í™•ì¥ ê°€ëŠ¥
- í•¨ìˆ˜ì™€ ë‹¬ë¦¬ ! ê¸°í˜¸ë¥¼ ì‚¬ìš©í•˜ë©°, ëŸ°íƒ€ì„ì´ ì•„ë‹Œ ì»´íŒŒì¼ íƒ€ì„ì— ì‹¤í–‰ë¨
ì˜ˆ: println!, vec!, assert_eq! ë“±ì€ ëª¨ë‘ ë§¤í¬ë¡œ

## ğŸ§© ë§¤í¬ë¡œì˜ ì¢…ë¥˜
| ì¢…ë¥˜       | ì˜ˆì‹œ ë˜ëŠ” ì„¤ëª…                                |
|------------------------|-----------------------------------------------|
| `macro_rules!`         | ì„ ì–¸ì  ë§¤í¬ë¡œ. íŒ¨í„´ ê¸°ë°˜ ì½”ë“œ ìƒì„±             |
| `#[derive]` ë§¤í¬ë¡œ     | `#[derive(Debug)]`, `#[derive(Clone)]` ë“± ìë™ trait êµ¬í˜„ |
| ì†ì„±(attribute) ë§¤í¬ë¡œ | `#[test]`, `#[route]`, `#[tokio::main]` ë“± í•¨ìˆ˜/íƒ€ì…ì— ë¶€ê°€ ë™ì‘ ë¶€ì—¬ |
| í•¨ìˆ˜(proc macro) ë§¤í¬ë¡œ| `my_macro!(...)` í˜•íƒœ. ì‚¬ìš©ì ì •ì˜ êµ¬ë¬¸ ì²˜ë¦¬ ê°€ëŠ¥ |


## ğŸ›  macro_rules! ì‚¬ìš©ë²•
```rust
#[macro_export]
macro_rules! say_hello {
    () => {
        println!("Hello from macro!");
    };
}
```

- #[macro_export]ë¥¼ ë¶™ì´ë©´ í¬ë ˆì´íŠ¸ ë£¨íŠ¸ì— ë“±ë¡ë˜ì–´ ì™¸ë¶€ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥
- ë‹¤ì–‘í•œ íŒ¨í„´ì„ ì •ì˜í•´ ì…ë ¥ì— ë”°ë¼ ë‹¤ë¥¸ ì½”ë“œë¥¼ ìƒì„± ê°€ëŠ¥

## ğŸ§ª í”„ë¡œì‹œì € ë§¤í¬ë¡œ ì˜ˆì‹œ
```rust
// lib.rs
use proc_macro::TokenStream;

#[proc_macro_derive(MyTrait)]
pub fn my_trait_derive(input: TokenStream) -> TokenStream {
    // ì…ë ¥ëœ êµ¬ì¡°ì²´ë¥¼ ë¶„ì„í•˜ê³  trait êµ¬í˜„ ì½”ë“œë¥¼ ìƒì„±
}
```

- proc_macro í¬ë ˆì´íŠ¸ í•„ìš”
- syn, quote ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ AST íŒŒì‹± ë° ì½”ë“œ ìƒì„±

## âš ï¸ ë§¤í¬ë¡œ ì‚¬ìš© ì‹œ ì£¼ì˜ì 
| í•­ëª©     | ì„¤ëª…                                                                 |
|-----------------------------|----------------------------------------------------------------------|
| ë””ë²„ê¹… ì–´ë ¤ì›€                | ë§¤í¬ë¡œëŠ” ì»´íŒŒì¼ íƒ€ì„ì— í™•ì¥ë˜ë¯€ë¡œ ì—ëŸ¬ ìœ„ì¹˜ ì¶”ì ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ       |
| ì´ë¦„ ì¶©ëŒ ìœ„í—˜               | ì „ì—­ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë“±ë¡ë˜ë¯€ë¡œ ë™ì¼ ì´ë¦„ì˜ ë§¤í¬ë¡œê°€ ì¶©ëŒí•  ìˆ˜ ìˆìŒ       |
| ê°€ë…ì„± ì €í•˜ ê°€ëŠ¥             | ê³¼ë„í•œ ë§¤í¬ë¡œ ì‚¬ìš©ì€ ì½”ë“œ íë¦„ì„ ë¶ˆëª…í™•í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŒ                |
| `#[macro_export]`ì˜ ë²”ìœ„     | ë£¨íŠ¸ ìŠ¤ì½”í”„ì— ë“±ë¡ë˜ë¯€ë¡œ ëª¨ë“ˆ ê²½ë¡œì™€ ë¬´ê´€í•˜ê²Œ ì „ì—­ì—ì„œ ì ‘ê·¼ë¨            |
| `Copy`ì™€ `Drop`ì€ ì–‘ë¦½ ë¶ˆê°€  | `Drop`ì„ êµ¬í˜„í•œ íƒ€ì…ì€ `Copy`ë¥¼ ë¶™ì¼ ìˆ˜ ì—†ìŒ â†’ ë§¤í¬ë¡œë¡œ ìƒì„±ëœ íƒ€ì…ë„ ì£¼ì˜ í•„ìš” |



## âœ¨ ì–¸ì œ ë§¤í¬ë¡œë¥¼ ì“°ë©´ ì¢‹ì€ê°€?
- ë°˜ë³µë˜ëŠ” ì½”ë“œ íŒ¨í„´ì„ ì¤„ì´ê³  ì‹¶ì„ ë•Œ
- ë‹¤ì–‘í•œ ì…ë ¥ì„ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ
- trait êµ¬í˜„, í…ŒìŠ¤íŠ¸, ë¼ìš°íŒ… ë“± ì½”ë“œ ìë™ ìƒì„±ì´ í•„ìš”í•  ë•Œ
- ëŸ°íƒ€ì„ ë¹„ìš© ì—†ì´ ì»´íŒŒì¼ íƒ€ì„ì— ì½”ë“œ í™•ì¥ì´ í•„ìš”í•  ë•Œ

## ğŸ“¦ ë§¤í¬ë¡œ ê´€ë¦¬ íŒ
| ì „ëµ           | ì„¤ëª…                                                                 |
|-----------------------------|----------------------------------------------------------------------|
| `macros.rs`                 | ê³µí†µ ë§¤í¬ë¡œë¥¼ í•œ íŒŒì¼ì— ëª¨ì•„ë‘ë©´ ìœ ì§€ë³´ìˆ˜ì™€ ì¬ì‚¬ìš©ì— ìœ ë¦¬í•¨             |
| `#[macro_export]`           | ë§¤í¬ë¡œë¥¼ í¬ë ˆì´íŠ¸ ë£¨íŠ¸ì— ë“±ë¡í•˜ì—¬ ì™¸ë¶€ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨          |
| ì´ë¦„ì— prefix ë¶™ì´ê¸°        | `math_approx_f64!`, `util_log!` ë“±ìœ¼ë¡œ ì´ë¦„ ì¶©ëŒ ë°©ì§€                  |
| ë‚´ë¶€ ì „ìš©ì€ export ìƒëµ     | `macro_rules!`ë§Œ ì‚¬ìš©í•˜ê³  `pub(crate)` ìˆ˜ì¤€ì—ì„œ ì œí•œí•˜ë©´ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ ê°€ëŠ¥ |


---

# ë§¤í¬ë¡œ ì„ ì–¸

 ì™¸ë¶€ í¬ë ˆì´íŠ¸ì—ì„œ macro_rules! ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì •í™•í•œ ìœ„ì¹˜ì— ì„ ì–¸ê³¼ ì„¤ì •ì´ í•„ìš”.
 
## âœ… 1. ë§¤í¬ë¡œ ì •ì˜ í¬ë ˆì´íŠ¸ì—ì„œ ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ë ¤ë©´
| ìœ„ì¹˜ | ì„¤ëª…                                                              |
|------------------------------|-------------------------------------------------------------------|
| `macros.rs` ë˜ëŠ” `macros/mod.rs` | `macro_rules!`ë¡œ ë§¤í¬ë¡œ ì •ì˜í•˜ê³  `#[macro_export]`ë¥¼ ë¶™ì—¬ì•¼ ë£¨íŠ¸ì— ë“±ë¡ë¨ |
| `lib.rs`                     | `mod macros;` ì„ ì–¸ì„ í†µí•´ ë§¤í¬ë¡œ ëª¨ë“ˆì„ ë£¨íŠ¸ì— í¬í•¨ì‹œì¼œì•¼ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥ |

```rust
// lib.rs
mod macros; // ë£¨íŠ¸ì— ë“±ë¡í•´ì•¼ #[macro_export]ê°€ ì‘ë™í•¨
```

```rust
// macros.rs
#[macro_export]
macro_rules! approx_f64 {
    ($a:expr, $b:expr, $eps:expr) => {
        (($a as f64) - ($b as f64)).abs() <= ($eps as f64)
    };
}
```

## âœ… 2. ì™¸ë¶€ í¬ë ˆì´íŠ¸ì—ì„œ
|    ìœ„ì¹˜    | ì„¤ëª…                                                              |
|------------------------------|-------------------------------------------------------------------|
| `Cargo.toml`                 | ë§¤í¬ë¡œ ì •ì˜ í¬ë ˆì´íŠ¸ë¥¼ `dependencies`ì— ì¶”ê°€                       |
| ì½”ë“œ ìƒë‹¨                    | `use crate_name::macro_name;` ë°©ì‹ìœ¼ë¡œ ë§¤í¬ë¡œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê°€ì ¸ì˜´   |


```rust
use your_crate_name::approx_f64;

fn main() {
    assert!(approx_f64!(0.1 + 0.2, 0.3, 1e-9));
}
```

### ğŸ” #[macro_use] extern crate ...;ëŠ” Rust 2015 ìŠ¤íƒ€ì¼ë¡œ, ì§€ê¸ˆì€ ëª…ì‹œì  use ë°©ì‹ì´ ê¶Œì¥ë¼ìš”

## âš ï¸ ì£¼ì˜ ìš”ì•½
| í•­ëª©               | ì„¤ëª…                                                                 |
|----------------------------|----------------------------------------------------------------------|
| `#[macro_export]`          | ë§¤í¬ë¡œë¥¼ í¬ë ˆì´íŠ¸ ë£¨íŠ¸ì— ë“±ë¡í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨          |
| `mod macros;`              | ë°˜ë“œì‹œ `lib.rs` ë˜ëŠ” `main.rs`ì—ì„œ ì„ ì–¸í•´ì•¼ ë£¨íŠ¸ ë“±ë¡ì´ ì‘ë™í•¨         |
| `pub use` ë¶ˆê°€             | `macro_rules!` ë§¤í¬ë¡œëŠ” `pub use`ë¡œ ì¬ìˆ˜ì¶œí•  ìˆ˜ ì—†ìŒ                  |

---


