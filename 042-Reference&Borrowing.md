# Reference & Borrowing

## 🧠 Rust의 참조자와 빌림 요약
### 1. 📌 참조자 (&T, &mut T)
- &T: 불변 참조자. 읽기만 가능, 여러 개 생성 가능
- &mut T: 가변 참조자. 쓰기 가능, 단 하나만 존재 가능
```rust
fn read(s: &String) { println!("{}", s); }      // 불변 참조
fn write(s: &mut String) { s.push_str("!"); }   // 가변 참조
```


### 2. 🔄 빌림(Borrowing)
- 소유권을 넘기지 않고 값을 함수에 전달하는 방식
- 함수는 값을 “빌려서” 사용하고, 원래 변수는 그대로 유지됨
```rust
fn main() {
    let s = String::from("Hello");
    let len = string_length(&s); // 빌림
    println!("s = {s}");          // 여전히 사용 가능
}
fn string_length(s: &String) -> usize {
    s.len()
}
```
### Borrowing 개념
![borrowng](/image/borrowing.png)


### 3. 🚫 가변 참조자 규칙
- 동시에 하나의 가변 참조자만 허용
- 또는 여러 개의 불변 참조자만 허용
- 두 가지를 동시에 사용할 수는 없음
```rust
let mut s = String::from("Hello");
let r1 = &s;      // 불변 참조
let r2 = &s;      // 또 다른 불변 참조
// let r3 = &mut s; // ❌ 컴파일 에러: 불변 참조 중에 가변 참조 불가
```


### 4. 🧼 스코프 분리로 해결 가능
```rust
let mut s = String::from("Hello");
{
    let r1 = &mut s;
    println!("{}", r1);
} // r1의 스코프 종료
let r2 = &mut s; // ✅ 이제 가능
```


### 5. 🧨 댕글링 참조자(Dangling Reference) 방지
Rust는 스코프가 끝난 값을 참조하는 포인터를 금지합니다.
컴파일 타임에 이를 감지하여 메모리 안전성을 보장합니다.
fn dangle() -> &String {
    let s = String::from("hello");
    &s // ❌ s는 함수 종료 시 drop됨 → 컴파일 에러
}


## ✅ 핵심 정리

| 항목                         | `&T` (불변 참조자)                     | `&mut T` (가변 참조자)                 |
|----------------------------|--------------------------------------|----------------------------------------|
| 소유권                     | 없음                                  | 없음                                   |
| 읽기                       | 가능                                  | 가능                                   |
| 쓰기                       | 불가능                                | 가능                                   |
| 동시에 여러 개 생성        | 가능                                  | 불가능 (단 하나만 허용)               |
| 불변 참조자와의 병행 사용  | 가능                                  | 불가능 (불변 참조자와 병행 불가)      |
| 스코프                     | 참조자가 스코프를 벗어나면 소멸됨     | 참조자가 스코프를 벗어나면 소멸됨     |
| 메모리 해제 영향           | 없음 (원본 값은 유지됨)               | 없음 (원본 값은 유지됨)               |
| 함수 인자 전달             | 읽기 전용으로 전달 가능               | 수정 가능하게 전달 가능               |
| 데이터 경쟁 방지           | 읽기만 하므로 안전                    | 단일 참조만 허용하여 안전             |


----
