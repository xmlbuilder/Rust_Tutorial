# 비동기 함수 테스트

## 🚀 비동기 함수 테스트란?
Rust는 async/await 문법을 통해 비동기 함수를 정의할 수 있습니다.
하지만 Rust 자체에는 비동기 런타임이 없기 때문에, 실제 실행을 위해서는 Tokio 같은 외부 런타임이 필요합니다.

## ✅ 비동기 함수 정의
```rust
async fn give_order(order: u64) -> u64 {
    println!("Processing {order}...");
    tokio::time::sleep(std::time::Duration::from_secs(3 - order)).await;
    println!("Finished {order}!");
    order
}
```

- async fn: 비동기 함수 선언
- tokio::time::sleep(...): 비동기 지연 (await 필요)
- await: Future가 완료될 때까지 기다림

## ✅ 테스트 모듈
```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[tokio::test]
    async fn test_give_order() {
        let result = give_order(1).await;
        assert_eq!(result, 1);
    }
}
```

- #[cfg(test)]: 테스트 시에만 컴파일
- #[tokio::test]: 비동기 테스트를 위한 Tokio 매크로
- async fn test_give_order(): 테스트 함수도 비동기
- await: 비동기 함수 호출 후 결과 기다림
- assert_eq!: 결과 검증

### ⚙️ #[tokio::test]의 역할
Tokio는 #[tokio::test] 매크로를 통해
테스트 함수에 자동으로 런타임을 생성해줍니다.

### ✅ 내부적으로 하는 일
- Tokio 런타임을 생성 (Runtime::new())
- 테스트 함수의 async fn을 실행할 수 있도록 설정
- 복잡한 설정 없이 간단하게 비동기 테스트 가능

### 📌 비동기 테스트 시 주의할 점

| 항목               | 설명                                                                 |
|--------------------|----------------------------------------------------------------------|
| `#[tokio::test]`   | `async fn` 테스트를 실행하기 위한 Tokio 런타임 매크로                     |
| `#[test] async fn` | 일반 `#[test]`는 `async fn`과 함께 사용할 수 없음                        |
| `await`            | 비동기 함수 호출 시 반드시 `.await`로 결과를 기다려야 함                  |
| `.await`           | Future를 완료시켜 실제 값을 반환받는 키워드                              |
| `tokio`            | 비동기 실행을 위한 런타임. `Cargo.toml`에 명시적으로 추가해야 함          |
| `Cargo.toml tokio features = ["full"]` | Tokio의 모든 기능을 사용하기 위한 설정. 테스트에 `time`, `macros` 등이 필요함 |


# Cargo.toml 예시
```
[dependencies]
tokio = { version = "1", features = ["full"] }
```


🧩 비동기 테스트 요약
| 구성 요소         | 설명                                      |
|------------------|-------------------------------------------|
| `async fn`       | 비동기 함수 정의                            |
| `.await`         | Future 완료까지 기다림                      |
| `#[tokio::test]` | 비동기 테스트 실행을 위한 런타임 자동 생성     |
| `assert_eq!`     | 결과 검증                                  |
| `tokio::time::sleep` | 비동기 지연 함수 (테스트 시 시간 제어 가능) |

---



